<!doctype html>
<html>
  <head>
    <title>Dashboard</title>
    <meta charset="UTF-8" />

    <script type="module">
      import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
      import {
        getAuth,
        onAuthStateChanged,
        signOut,
      } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js";
      import {
        getFirestore,
        doc,
        getDoc,
      } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

      const firebaseConfig = {
        apiKey: "AIzaSyAC-NfULdAUdp4yDbKHiNYTF9EZg1qG_Lg",
        authDomain: "yugastrlogin.firebaseapp.com",
        projectId: "yugastrlogin",
        storageBucket: "yugastrlogin.firebasestorage.app",
        messagingSenderId: "391276873890",
        appId: "1:391276873890:web:79f5c1ed7afa32ec8daffb",
      };

      const app = initializeApp(firebaseConfig);
      const auth = getAuth(app);
      const db = getFirestore(app);

      // Store user course globally for card navigation
      window.userCourse = null;

      onAuthStateChanged(auth, async (user) => {
        if (user) {
          const docSnap = await getDoc(doc(db, "users", user.uid));

          if (docSnap.exists()) {
            const data = docSnap.data();

            // Store course globally
            window.userCourse = (data.course || "").toUpperCase();

            // Basic Info
            document.getElementById("userName").innerText = data.name;
            document.getElementById("email").innerText = data.email;
            document.getElementById("phone").innerText = data.phone;
            document.getElementById("course").innerText = data.course;

            // Avatar
            document.getElementById("avatar").innerText = data.name
              .charAt(0)
              .toUpperCase();

            // Role Based Changes
            if (data.role === "teacher") {
              document.getElementById("profileTitle").innerText =
                "Teacher Profile";
              document.getElementById("userId").innerText =
                data.teacherId || "â€”";
            } else {
              document.getElementById("profileTitle").innerText =
                "Student Profile";
              document.getElementById("userId").innerText =
                data.studentId || "â€”";
            }
          }
        } else {
          window.location.href = "login/login.html";
        }
      });

      // Navigate to course-specific subjects page
      window.goToSubjects = function () {
        if (!window.userCourse) {
          alert("Loading course information...");
          return;
        }
        const courseFile = window.userCourse === "MCA" ? "mca.html" : "bca.html";
        window.location.href = "subjects/" + courseFile;
      };

      window.logoutUser = function () {
        signOut(auth).then(() => {
          window.location.href = "login/login.html";
        });
      };
    </script>

    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        font-family: "Poppins", sans-serif;
      }
      body {
        background: #f4f6fb;
      }

      .navbar {
        height: 65px;
        background: white;
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 0 40px;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.05);
      }

      .brand {
        font-size: 22px;
        font-weight: 600;
        color: #2c3e50;
      }

      .nav-right {
        display: flex;
        gap: 25px;
        align-items: center;
      }

      .nav-link {
        text-decoration: none;
        color: #34495e;
        font-weight: 500;
      }

      .nav-link:hover {
        color: #4e73df;
      }

      .logout-btn {
        padding: 8px 18px;
        border: none;
        border-radius: 8px;
        background: #eef2ff;
        cursor: pointer;
      }

      .logout-btn:hover {
        background: #dbe4ff;
      }

      .dashboard {
        display: flex;
        padding: 20px;
      }

      .sidebar {
        width: 260px;
      }

      .profile-card {
        background: white;
        padding: 20px;
        border-radius: 15px;
        box-shadow: 0 10px 25px rgba(0, 0, 0, 0.05);
      }

      .avatar {
        width: 60px;
        height: 60px;
        background: linear-gradient(135deg, #4e73df, #1cc88a);
        color: white;
        font-size: 24px;
        display: flex;
        justify-content: center;
        align-items: center;
        border-radius: 15px;
        margin-bottom: 15px;
      }

      .profile-card p {
        margin-top: 6px;
        font-size: 14px;
      }

      .main-content {
        flex: 1;
        margin-left: 30px;
      }

      .secondary-nav {
        background: white;
        padding: 10px;
        border-radius: 12px;
        display: flex;
        gap: 20px;
        margin-bottom: 20px;
        box-shadow: 0 5px 20px rgba(0, 0, 0, 0.05);
      }

      .secondary-nav button {
        border: none;
        background: none;
        padding: 8px 12px;
        cursor: pointer;
        border-radius: 8px;
      }

      .secondary-nav button:hover {
        background: #dfe7ff;
      }

      .card-grid {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 20px;
      }

      .card {
        background: white;
        border-radius: 15px;
        overflow: hidden;
        box-shadow: 0 10px 25px rgba(0, 0, 0, 0.05);
      }

      .card-img {
        height: 200px;
        background: #cfd6e6;
        display: flex;
        justify-content: center;
        align-items: center;
        color: #3a57e8;
        font-weight: 500;
      }

      .card-footer {
        padding: 15px;
        background: #f8f9fd;
      }
    </style>
  </head>

  <body>
    <!-- NAVBAR -->
    <div class="navbar">
      <div class="brand">Ramaiah</div>
      <div class="nav-right">
        <a href="home.html" class="nav-link">Home</a>
        <a href="support/support.html" class="nav-link">Support</a>
        <button class="logout-btn" onclick="logoutUser()">Logout</button>
      </div>
    </div>

    <div class="dashboard">
      <!-- SIDEBAR -->
      <div class="sidebar">
        <div class="profile-card">
          <div class="avatar" id="avatar">U</div>
          <h3 id="profileTitle">User Profile</h3>
          <p id="userName">Guest</p>

          <p>Email: <span id="email">â€”</span></p>
          <p>Phone: <span id="phone">â€”</span></p>
          <p>Course: <span id="course">â€”</span></p>
          <p>ID: <span id="userId">â€”</span></p>
        </div>
      </div>

      <!-- MAIN CONTENT -->
      <div class="main-content">
        <div class="secondary-nav">
          <button>Dashboard</button>
          <button>My Papers</button>
          <button>Upload</button>
          <button>Settings</button>
        </div>

        <div class="card-grid">
          <div
            class="card"
            onclick="goToSubjects()"
            style="cursor: pointer"
          >
            <div class="card-img">Add image link</div>
            <div class="card-footer">Study Material</div>
          </div>

          <div
            class="card"
            onclick="window.location.href = 'databank/data_bank.html'"
            style="cursor: pointer"
          >
            <div class="card-img">Add image link</div>
            <div class="card-footer">Data Bank</div>
          </div>

          <div
            class="card"
            onclick="window.location.href = 'connect/data_bank_form.html'"
            style="cursor: pointer"
          >
            <div class="card-img">Add image link</div>
            <div class="card-footer">Connect</div>
          </div>

          <div
            class="card"
            onclick="window.location.href = 'databankdata_bank.html'"
            style="cursor: pointer"
          >
            <div class="card-img">Add image link</div>
            <div class="card-footer">Study material (add details later)</div>
          </div>
        </div>
      </div>
    </div>
        <!-- PASTE CHATBOT CODE HERE (before body ends) -->
    
<!-- FLOATING BUTTON -->
<div id="chat-toggle">ðŸ’¬</div>

<!-- CHAT WINDOW -->
<div id="chatbot">
  <div id="chat-header">
    AI Assistant
    <span id="close-chat">âœ–</span>
  </div>

  <div id="chat-box"></div>

  <div id="chat-input-area">
    <input id="chat-input" type="text" placeholder="Ask something..." />
    <button id="sendBtn">Send</button>
  </div>
</div>

<!-- FOOTER -->
<footer class="site-footer">
  <div class="footer-container">
    <div class="footer-about-full">
      <h3>About ProStudent</h3>
      <p>
        Pro Student is your all-in-one academic companion designed to support students in their learning journey. From organized notes and previous year question papers to helpful study resources, we make it easier for you to stay prepared and track your progress. Learn smarter, stay consistent, and achieve your goals with Pro Student.
      </p>
    </div>

    <div class="footer-team-row">
      <h3>Developed By</h3>

      <div class="team-grid">
        <div class="team-member">
          <h4>Mukund Keshwani</h4>
          <p>Email: mukund.haresh@bcah.christuniversity.in</p>
          <p>Contact: +91 9359888264</p>
          <a href="https://www.linkedin.com/in/mukund-keshwani-315148378/" target="_blank">LinkedIn</a>
        </div>

        <div class="team-member">
          <h4>Simran Singh</h4>
          <p>Email: simran.singh@bcah.christuniversity.in</p>
          <p>Contact: +91 9798380631</p>
          <a href="https://www.linkedin.com/in/simran-singh-ab9524350/" target="_blank">LinkedIn</a>
        </div>

        <div class="team-member">
          <h4>Piyush Sinha</h4>
          <p>Email: piyush.sinha@bcah.christuniversity.in</p>
          <p>Contact: +91 7759040065</p>
          <a href="https://www.linkedin.com/in/piyush-sinha-91702a378/" target="_blank">LinkedIn</a>
        </div>
      </div>
      <br />
      <h3>About Us</h3>
      <p>
        We are The Closing Tags, a team of first-year BCA students from Christ University who are passionate about learning and building through real-world experiences. We actively participate in hackathons and tech events to apply our classroom knowledge to practical problems, improve our skills, and work collaboratively under real constraints. Our focus is on creating clean, user-friendly, and meaningful solutions while continuously growing as developers through hands-on projects and innovation-driven learning.
      </p>
    </div>
  </div>

  <div class="footer-bottom">
    <p>Â© 2026 Navio. All rights reserved.</p>
  </div>
</footer>

<style>
#chat-toggle{
  position:fixed;
  bottom:20px;
  right:20px;
  width:65px;
  height:65px;
  background:#4e73df;
  color:white;
  font-size:28px;
  display:flex;
  align-items:center;
  justify-content:center;
  border-radius:50%;
  cursor:pointer;
  z-index:9999;
  transition: all 0.3s ease;
}

#chat-toggle:hover {
  transform: scale(1.1);
  box-shadow: 0 5px 20px rgba(78, 115, 223, 0.4);
}

#chatbot{
  position:fixed;
  bottom:100px;
  right:20px;
  width:320px;
  height:420px;
  background:white;
  border-radius:15px;
  box-shadow:0 10px 30px rgba(0,0,0,0.3);
  display:none;
  flex-direction:column;
  overflow:hidden;
  z-index:9999;
  transition: all 0.3s ease;
}

#chatbot.expanded {
  width:600px;
  height:600px;
  bottom:50px;
}

#chat-header{
  background:#4e73df;
  color:white;
  padding:12px;
  display:flex;
  justify-content:space-between;
  font-weight:600;
}

#chat-box{
  flex:1;
  padding:10px;
  overflow-y:auto;
  font-size:14px;
}

#chat-input-area{
  display:flex;
  border-top:1px solid #ddd;
}

#chat-input{
  flex:1;
  padding:10px;
  border:none;
  outline:none;
  font-size:14px;
}

#chat-input-area button{
  background:#4e73df;
  color:white;
  border:none;
  padding:10px 15px;
  cursor:pointer;
  font-weight:600;
  transition: background 0.2s;
}

#chat-input-area button:hover {
  background:#3d5cc4;
}

#close-chat {
  cursor:pointer;
  font-size:20px;
  transition: transform 0.2s;
}

#close-chat:hover {
  transform: scale(1.2);
}

/* FOOTER STYLES */
.site-footer {
  margin-top: 60px;
  padding: 50px 40px 20px;
  background: rgba(255, 255, 255, 0.25);
  backdrop-filter: blur(12px);
  border-top: 1px solid rgba(255, 255, 255, 0.4);
  color: #222;
}

.footer-about-full {
  width: 100%;
  margin-bottom: 40px;
}

.footer-about-full p {
  width: 100%;
  max-width: 1100px;
  line-height: 1.8;
  color: #333;
}

.footer-team-row h3 {
  font-size: 20px;
  margin-bottom: 20px;
}

.team-grid {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: 30px;
}

.team-member {
  background: rgba(255, 255, 255, 0.45);
  backdrop-filter: blur(8px);
  border-radius: 16px;
  padding: 20px;
  text-align: center;
  box-shadow: 0 10px 25px rgba(0, 0, 0, 0.08);
}

.team-member h4 {
  font-size: 16px;
  margin-bottom: 8px;
}

.team-member p {
  font-size: 13px;
  margin: 4px 0;
  color: #444;
}

.team-member a {
  display: inline-block;
  margin-top: 8px;
  font-size: 13px;
  color: #6b4eff;
  text-decoration: none;
}

.team-member a:hover {
  text-decoration: underline;
}

.footer-bottom {
  text-align: center;
  margin-top: 40px;
  padding-top: 15px;
  font-size: 13px;
  border-top: 1px solid rgba(0, 0, 0, 0.1);
  color: #444;
}

@media (max-width: 900px) {
  .team-grid {
    grid-template-columns: 1fr;
  }
}
</style>

<script>
const API_KEY = "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";

let isExpanded = false;

// OPEN CHAT
document.getElementById("chat-toggle").onclick = ()=>{
  const chatbot = document.getElementById("chatbot");
  chatbot.style.display = "flex";
  
  // Expand on second click
  setTimeout(() => {
    isExpanded = !isExpanded;
    if (isExpanded) {
      chatbot.classList.add("expanded");
    } else {
      chatbot.classList.remove("expanded");
    }
  }, 100);
};

// CLOSE CHAT
document.getElementById("close-chat").onclick = ()=>{
  document.getElementById("chatbot").style.display = "none";
  isExpanded = false;
};

// SEND BUTTON
document.getElementById("sendBtn").onclick = sendMessage;

// ENTER KEY SUPPORT
document.getElementById("chat-input").addEventListener("keypress", (e) => {
  if (e.key === "Enter") {
    e.preventDefault();
    sendMessage();
  }
});

async function sendMessage(){
  let input = document.getElementById("chat-input");
  let msg = input.value.trim();
  if(!msg) return;

  let box = document.getElementById("chat-box");
  box.innerHTML += `<p><b>You:</b> ${msg}</p>`;
  input.value="";

  try{
    const res = await fetch("https://openrouter.ai/api/v1/chat/completions",{
      method:"POST",
      headers:{
        "Authorization":"Bearer "+API_KEY,
        "Content-Type":"application/json"
      },
      body: JSON.stringify({
        model:"openai/gpt-3.5-turbo",
        messages:[{role:"user",content:msg}]
      })
    });

    const data = await res.json();
    console.log(data);

    let reply = data.choices?.[0]?.message?.content || "No reply";

    box.innerHTML += `<p><b>Bot:</b> ${reply}</p>`;
    box.scrollTop = box.scrollHeight;

  }catch(e){
    box.innerHTML += `<p style="color:red;">API error</p>`;
  }
}
</script>


  </body>
</html>
